# ADI Stack on OpenShift (Testnet/Sepolia)
#
# Usage:
#   helm install adi-stack ./adi-stack \
#     -f examples/values-openshift-testnet.yaml \
#     -f examples/values-performance-medium.yaml

# Genesis configuration - REQUIRED
genesis:
  bridgehubAddress: "0xc1662F0478e0E93Dc6CC321281Eb180A21036Da6"
  chainId: "36900"
  mainNodeRpcUrl: "https://rpc.ab.testnet.adifoundation.ai/"

# Erigon - resources come from performance tier overlay
erigon:
  enabled: true
  chain: sepolia
  pruneMode: full
  caplin:
    enabled: true
    checkpointSyncUrl: "https://sepolia.beaconstate.info/eth/v2/debug/beacon/states/finalized"

# L1 RPC configuration - Not needed when erigon.enabled=true
# Uncomment below to use external RPC instead of internal Erigon
# l1Rpc:
#   url: "https://eth-sepolia.example.com"

# OpenShift-specific settings
openshift:
  enabled: true
  # Security context compatible with restricted SCC
  securityContext:
    runAsNonRoot: true
    # Do NOT set runAsUser - OpenShift assigns from namespace range
    seccompProfile:
      type: RuntimeDefault

# External node - resources come from performance tier overlay

# Cloudflared
cloudflared:
  enabled: true
  # Set tunnel token via --set or existingSecret
  # existingSecret:
  #   name: cloudflared-credentials
  #   key: tunnel-token

# Disable proof-sync for testnet
proofSync:
  enabled: false

# Use OpenShift Routes instead of Ingress
ingress:
  enabled: true
  type: route # Explicitly use OpenShift Routes
  hostname: adi-testnet.apps.openshift.example.com
  path: /
  tls:
    enabled: true
  route:
    annotations:
      haproxy.router.openshift.io/timeout: 3600s
    termination: edge
    insecureEdgeTerminationPolicy: Redirect
    wildcardPolicy: None

# ServiceAccount - let OpenShift manage
serviceAccount:
  create: true
  annotations: {}

# RBAC - minimal permissions
rbac:
  create: true
  rules: [] # No special permissions needed

# Network policies - works with OpenShift SDN
networkPolicy:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              network.openshift.io/policy-group: ingress
      ports:
        - protocol: TCP
          port: 3050
        - protocol: TCP
          port: 3071
  egress:
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
            except:
              - 10.0.0.0/8
              - 172.16.0.0/12
              - 192.168.0.0/16
      ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 8545

# Pod disruption budget - disabled for testnet
podDisruptionBudget:
  enabled: false

# Prometheus monitoring via OpenShift User Workload Monitoring
metrics:
  serviceMonitor:
    enabled: false # Enable if User Workload Monitoring is configured
    namespace: openshift-user-workload-monitoring
    interval: 30s
    labels:
      prometheus: user-workload

# Security context - OpenShift restricted SCC compatible
securityContext:
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

containerSecurityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
