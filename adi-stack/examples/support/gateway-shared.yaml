# Shared Gateway for multi-namespace routing
# Install this after Contour to create a single Gateway that handles all adi-stack deployments
#
# Apply:
#   kubectl apply -f https://raw.githubusercontent.com/settlemint/adi-helm/main/adi-stack/examples/support/gateway-shared.yaml
#
# This creates:
#   - GatewayClass "contour" pointing to Contour controller
#   - Gateway "adi-gateway" in "gateway" namespace accepting routes from all namespaces
#
# Then deploy adi-stack with:
#   helm install adi-stack adi-stack/adi-stack -n adi-testnet --create-namespace \
#     -f values-testnet.yaml \
#     -f values-ingress-contour.yaml \
#     --set ingress.gateway.namespace=gateway \
#     --set ingress.gateway.name=adi-gateway \
#     --set ingress.hostname=testnet.example.com
---
apiVersion: gateway.networking.k8s.io/v1
kind: GatewayClass
metadata:
  name: contour
spec:
  controllerName: projectcontour.io/gateway-controller
---
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: adi-gateway
  namespace: gateway
spec:
  gatewayClassName: contour
  listeners:
    - name: http
      port: 80
      protocol: HTTP
      allowedRoutes:
        namespaces:
          from: All
    - name: https
      port: 443
      protocol: HTTPS
      allowedRoutes:
        namespaces:
          from: All
      tls:
        mode: Terminate
        certificateRefs: []
