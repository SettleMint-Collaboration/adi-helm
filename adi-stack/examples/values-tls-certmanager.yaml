# TLS with cert-manager
# Layer this on top of your base values file
#
# Prerequisites:
#   # 1. Install cert-manager
#   kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.17.1/cert-manager.yaml
#
#   # 2. Enable Gateway API support (required for Contour/Gateway API)
#   kubectl patch deployment cert-manager -n cert-manager \
#     --type='json' -p='[{"op": "add", "path": "/spec/template/spec/containers/0/args/-", "value": "--enable-gateway-api"}]'
#
#   # 3. Create ClusterIssuer (edit email first!)
#   kubectl apply -f https://raw.githubusercontent.com/settlemint/adi-helm/main/adi-stack/examples/cert-manager-clusterissuer.yaml
#
# Usage with Gateway API (Contour):
#   helm install adi-stack ./adi-stack -n adi-stack --create-namespace \
#     -f examples/values-testnet.yaml \
#     -f examples/values-ingress-contour.yaml \
#     -f examples/values-tls-certmanager.yaml \
#     --set ingress.hostname=rpc.example.com
#
# Usage with Kubernetes Ingress:
#   helm install adi-stack ./adi-stack -n adi-stack --create-namespace \
#     -f examples/values-testnet.yaml \
#     -f examples/values-tls-certmanager.yaml \
#     --set ingress.hostname=rpc.example.com

ingress:
  tls:
    enabled: true
    # Leave empty - cert-manager will create the secret automatically
    secretName: ""

  # Gateway API cert-manager integration
  # Creates a Certificate resource that provisions the TLS secret
  certManager:
    enabled: true
    issuerRef:
      name: "letsencrypt-prod"
      kind: "ClusterIssuer"
    # Optional: customize certificate lifetime
    # duration: "2160h"    # 90 days (default)
    # renewBefore: "360h"  # 15 days before expiry (default)

  # Kubernetes Ingress cert-manager integration (via annotations)
  # Used when ingress.type is "ingress" instead of "gateway"
  kubernetes:
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
