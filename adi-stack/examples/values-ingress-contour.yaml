# Contour Gateway API configuration for JSON-RPC workloads
# Layer this with base config for Gateway API ingress with timeout support
#
# Prerequisites:
#   # 1. Install Contour in shared gateway namespace
#   helm repo add projectcontour https://projectcontour.io/charts
#   helm repo update
#   helm install contour projectcontour/contour -n gateway --create-namespace \
#     -f https://raw.githubusercontent.com/settlemint/adi-helm/main/adi-stack/examples/support/contour-values-aws.yaml
#
#   # 2. Create shared Gateway
#   kubectl apply -f https://raw.githubusercontent.com/settlemint/adi-helm/main/adi-stack/examples/support/gateway-shared.yaml
#
#   # 3. Verify
#   kubectl get gatewayclass contour
#   kubectl get gateway -n gateway
#
# Usage (referencing shared Gateway):
#   helm install adi-stack ./adi-stack -n adi-testnet --create-namespace \
#     -f examples/values-testnet.yaml \
#     -f examples/values-ingress-contour.yaml \
#     --set ingress.hostname=testnet.example.com \
#     --set ingress.gateway.gatewayName=adi-gateway \
#     --set ingress.gateway.gatewayNamespace=gateway
#
# With TLS (cert-manager):
#   helm install adi-stack ./adi-stack -n adi-testnet --create-namespace \
#     -f examples/values-testnet.yaml \
#     -f examples/values-ingress-contour.yaml \
#     -f examples/values-tls-certmanager.yaml \
#     --set ingress.hostname=testnet.example.com \
#     --set ingress.gateway.gatewayName=adi-gateway \
#     --set ingress.gateway.gatewayNamespace=gateway

ingress:
  enabled: true
  type: gateway
  # -- Set your hostname (REQUIRED)
  hostname: ""

  tls:
    enabled: false
    # -- Leave empty for cert-manager auto-creation, or specify existing secret
    secretName: ""

  gateway:
    # -- Contour Gateway class
    className: "contour"
    # -- Enable HTTPProxy for timeout configuration (recommended for JSON-RPC)
    useHTTPProxy: true

    # -- Timeout configuration optimized for blockchain JSON-RPC
    timeouts:
      # -- Response timeout: long enough for eth_call, eth_estimateGas
      response: "30s"
      # -- Idle timeout: 5 minutes for persistent HTTP connections
      idle: "300s"
      # -- Connection idle: keep TCP connections alive
      idleConnection: "1h"

    # -- Retry policy (disabled for JSON-RPC as calls are not idempotent)
    retryPolicy:
      count: 0
      perTryTimeout: "10s"
